name: variables and Workflows
on: 
  workflow_dispatch:
    push:
      paths:
        - - ".github/workflows/exploring-variables_secrets.yml"
    # schedule:
    #   - cron: "* */1 * * *"


env:
  Container_Registery: docker.io
  image_name: abcd
  docker_name: sanchit


jobs:
  docker_build:
    runs-on: ubuntu-latest
    steps:
      - name: docker build
        run: echo docker build -t ${{env.Container_Registery}}/${{env.docker_name}}/${{env.image_name}}:latest .
      
      - name: docker login
        run: echo docker login --username=${{env.docker_name}} --password=${{secrets.DOCKER_PASSWORD}} 
      
      - name: docker push
        run: echo docker push ${{env.Container_Registery}}/${{env.docker_name}}/${{env.image_name}}:latest
  
  deploy:
    runs-on: ubuntu-latest
    concurrency:
      group: deployment
      cancel-in-progress: false
    needs: docker_build
    steps:

    - name: docker run
      timeout-minutes: 1
      run: |
          echo docker run -d -p 80:80 ${{env.Container_Registery}}/${{env.image_name}}/${{env.image_name}}:latest
          sleep 600s
